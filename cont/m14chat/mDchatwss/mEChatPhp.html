<muestra-codigo>
 <div>
  <div><span
     style="color: #800000;">&lt;?php</span></div><br>
  <div><span
     style="color: #0000ff;">namespace</span><span
     style="color: #000000;"> </span><span
     style="color: #267f99;">Srv</span><span
     style="color: #000000;">;</span></div><br>
  <div><span
     style="color: #0000ff;">use</span><span
     style="color: #000000;"> </span><span
     style="color: #267f99;">\SplObjectStorage</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #0000ff;">use</span></div>
  <div><span
     style="color: #000000;">&nbsp;Ratchet\</span><span
     style="color: #267f99;">MessageComponentInterface</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #0000ff;">use</span><span
     style="color: #000000;"> Ratchet\</span><span
     style="color: #267f99;">ConnectionInterface</span><span
     style="color: #000000;">;</span></div><br>
  <div><span
     style="color: #0000ff;">class</span><span
     style="color: #000000;"> </span><span
     style="color: #267f99;">Chat</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">implements</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #267f99;">MessageComponentInterface</span></div>
  <div><span
     style="color: #000000;">{</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #0000ff;">protected</span></div>
  <div><span
     style="color: #000000;">&nbsp;SplObjectStorage </span><span
     style="color: #001080;">$conexiones</span><span
     style="color: #000000;">;</span></div><br>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #0000ff;">public</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">function</span><span
     style="color: #000000;"> </span><span
     style="color: #795e26;">__construct</span><span
     style="color: #000000;">()</span></div>
  <div><span
     style="color: #000000;">&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #008000;">// Crea un arreglo de objetos.</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #0000ff;">$this</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">conexiones</span><span
     style="color: #000000;"> =</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #0000ff;">new</span><span
     style="color: #000000;"> </span><span
     style="color: #267f99;">SplObjectStorage</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;}</span></div><br>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #0000ff;">public</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">function</span><span
     style="color: #000000;"> </span><span
     style="color: #795e26;">onOpen</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #267f99;">ConnectionInterface</span><span
     style="color: #000000;"> </span><span
     style="color: #001080;">$con</span></div>
  <div><span
     style="color: #000000;">&nbsp;)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #008000;">// Guarda la conexi√≥n.</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #0000ff;">$this</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">conexiones</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">attach</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">,</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">resourceId</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;);</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #795e26;">echo</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"Conectado: "</span><span
     style="color: #000000;"> </span><span
     style="color: #000000;">.</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">resourceId</span><span
     style="color: #000000;"> </span><span
     style="color: #000000;">.</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"</span><span
     style="color: #ee0000;">\n</span><span
     style="color: #a31515;">"</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;}</span></div><br>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #0000ff;">public</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">function</span><span
     style="color: #000000;"> </span><span
     style="color: #795e26;">onMessage</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #267f99;">ConnectionInterface</span><span
     style="color: #000000;"> </span><span
     style="color: #001080;">$origen</span><span
     style="color: #000000;">,</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$msg</span></div>
  <div><span
     style="color: #000000;">&nbsp;)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$id</span><span
     style="color: #000000;"> = </span><span
     style="color: #0000ff;">$this</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">conexiones</span><span
     style="color: #000000;">[</span><span
     style="color: #001080;">$origen</span><span
     style="color: #000000;">];</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #795e26;">echo</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"</span></div>
  <div><span
     style="color: #a31515;">Origen:&nbsp;{</span><span
     style="color: #001080;">$id</span><span
     style="color: #a31515;">}</span></div>
  <div><span
     style="color: #a31515;">Mensaje: </span><span
     style="color: #001080;">$msg</span><span
     style="color: #ee0000;">\n</span><span
     style="color: #a31515;">"</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #af00db;">foreach</span><span
     style="color: #000000;"> (</span><span
     style="color: #0000ff;">$this</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">conexiones</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;as </span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">send</span><span
     style="color: #000000;">(</span><span
     style="color: #001080;">$msg</span><span
     style="color: #000000;">);</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;}</span></div>
  <div><span
     style="color: #000000;">&nbsp;}</span></div><br>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #0000ff;">public</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">function</span><span
     style="color: #000000;"> </span><span
     style="color: #795e26;">onClose</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #267f99;">ConnectionInterface</span><span
     style="color: #000000;"> </span><span
     style="color: #001080;">$con</span></div>
  <div><span
     style="color: #000000;">&nbsp;)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #0000ff;">$this</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">conexiones</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">detach</span><span
     style="color: #000000;">(</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">);</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #795e26;">echo</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"Desconectado: "</span><span
     style="color: #000000;"> </span><span
     style="color: #000000;">.</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">resourceId</span><span
     style="color: #000000;"> </span><span
     style="color: #000000;">.</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"</span><span
     style="color: #ee0000;">\n</span><span
     style="color: #a31515;">"</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;}</span></div><br>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #0000ff;">public</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">function</span><span
     style="color: #000000;"> </span><span
     style="color: #795e26;">onError</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #267f99;">ConnectionInterface</span><span
     style="color: #000000;"> </span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">,</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #267f99;">\Exception</span><span
     style="color: #000000;"> </span><span
     style="color: #001080;">$e</span></div>
  <div><span
     style="color: #000000;">&nbsp;)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #795e26;">echo</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"Error: "</span><span
     style="color: #000000;"> </span><span
     style="color: #000000;">.</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$e</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">getMessage</span><span
     style="color: #000000;">() </span><span
     style="color: #000000;">.</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"</span><span
     style="color: #ee0000;">\n</span><span
     style="color: #a31515;">"</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">close</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;}</span></div>
  <div><span
     style="color: #000000;">}</span></div><br>
 </div>
</muestra-codigo>