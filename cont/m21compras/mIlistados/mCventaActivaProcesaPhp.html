<muestra-codigo>
 <div>
  <div><span
     style="color: #800000;">&lt;?php</span></div><br>
  <div><span
     style="color: #af00db;">require_once</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"srv/dao/"</span><span
     style="color: #000000;"> </span><span
     style="color: #000000;">.</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #a31515;">"/ventaActivaBusca.php"</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #af00db;">require_once</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #a31515;">"srv/dao/ventaAgrega.php"</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #af00db;">require_once</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"srv/txt/"</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #000000;">.</span><span
     style="color: #000000;"> </span><span
     style="color: #a31515;">"txtVentaNoEncontrada.php"</span><span
     style="color: #000000;">;</span></div><br>
  <div><span
     style="color: #0000ff;">use</span><span
     style="color: #000000;"> srv\dao\</span><span
     style="color: #267f99;">AccesoBd</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #0000ff;">use</span><span
     style="color: #000000;"> srv\modelo\</span><span
     style="color: #267f99;">Venta</span><span
     style="color: #000000;">;</span></div><br>
  <div><span
     style="color: #0000ff;">function</span><span
     style="color: #000000;"> </span><span
     style="color: #795e26;">ventaActivaProcesa</span><span
     style="color: #000000;">()</span></div>
  <div><span
     style="color: #000000;">{</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;"> = </span><span
     style="color: #267f99;">AccesoBd</span><span
     style="color: #000000;">::</span><span
     style="color: #795e26;">getCon</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">beginTransaction</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #001080;">$modelo</span><span
     style="color: #000000;"> = </span><span
     style="color: #795e26;">ventaActivaBusca</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;</span><span
     style="color: #af00db;">if</span><span
     style="color: #000000;"> (</span><span
     style="color: #001080;">$modelo</span><span
     style="color: #000000;"> === </span><span
     style="color: #0000ff;">false</span><span
     style="color: #000000;">)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #af00db;">throw</span><span
     style="color: #000000;"> </span><span
     style="color: #0000ff;">new</span><span
     style="color: #000000;"> </span><span
     style="color: #267f99;">Exception</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #795e26;">txtVentaNoEncontrada</span><span
     style="color: #000000;">()</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;);</span></div>
  <div><span
     style="color: #000000;">&nbsp;}&nbsp;</span><span
     style="color: #af00db;">else</span><span
     style="color: #000000;">&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$modelo</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">valida</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$detalles</span><span
     style="color: #000000;"> = </span><span
     style="color: #001080;">$modelo</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">detalles</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$stmt</span><span
     style="color: #000000;"> = </span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">prepare</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #a31515;">"</span><span
     style="color: #0000ff;">UPDATE</span><span
     style="color: #a31515;"> PRODUCTO</span></div>
  <div><span
     style="color: #a31515;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #0000ff;">SET</span><span
     style="color: #a31515;"> PROD_EXISTENCIAS </span><span
     style="color: #000000;">=</span></div>
  <div><span
     style="color: #a31515;">&nbsp;&nbsp;&nbsp;&nbsp;:existencias</span></div>
  <div><span
     style="color: #a31515;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #0000ff;">WHERE</span><span
     style="color: #a31515;"> PROD_ID </span><span
     style="color: #000000;">=</span><span
     style="color: #a31515;"> :prodId</span><span
     style="color: #a31515;">"</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;);</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #af00db;">foreach</span><span
     style="color: #000000;"> (</span><span
     style="color: #001080;">$detalles</span><span
     style="color: #000000;"> as </span><span
     style="color: #001080;">$dtv</span><span
     style="color: #000000;">)&nbsp;{</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$producto</span><span
     style="color: #000000;"> = </span><span
     style="color: #001080;">$dtv</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">producto</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #001080;">$stmt</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">execute</span><span
     style="color: #000000;">(([</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span
     style="color: #a31515;">":prodId"</span><span
     style="color: #000000;"> =&gt; </span><span
     style="color: #001080;">$producto</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">id</span><span
     style="color: #000000;">,</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span
     style="color: #a31515;">":existencias"</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;=&gt; </span><span
     style="color: #001080;">$producto</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">existencias</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- </span><span
     style="color: #001080;">$dtv</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">cantidad</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;]));</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;}</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$stmt</span><span
     style="color: #000000;"> = </span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">prepare</span><span
     style="color: #000000;">(</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #a31515;">"</span><span
     style="color: #0000ff;">UPDATE</span><span
     style="color: #a31515;"> VENTA</span></div>
  <div><span
     style="color: #a31515;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span
     style="color: #0000ff;">SET</span><span
     style="color: #a31515;"> VENT_ACTIVA </span><span
     style="color: #000000;">=</span><span
     style="color: #a31515;"> </span><span
     style="color: #098658;">0</span></div>
  <div><span
     style="color: #a31515;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span
     style="color: #0000ff;">WHERE</span><span
     style="color: #a31515;"> VENT_ID </span><span
     style="color: #000000;">=</span><span
     style="color: #a31515;"> :id</span><span
     style="color: #a31515;">"</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;);</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$stmt</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">execute</span><span
     style="color: #000000;">([</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;&nbsp;</span><span
     style="color: #a31515;">":id"</span><span
     style="color: #000000;"> =&gt; </span><span
     style="color: #001080;">$modelo</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">id</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;]);</span></div><br>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$venta</span><span
     style="color: #000000;"> = </span><span
     style="color: #0000ff;">new</span><span
     style="color: #000000;"> </span><span
     style="color: #267f99;">Venta</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$venta</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">activa</span><span
     style="color: #000000;"> = </span><span
     style="color: #0000ff;">true</span><span
     style="color: #000000;">;</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$venta</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #001080;">detalles</span><span
     style="color: #000000;"> = [];</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #795e26;">ventaAgrega</span><span
     style="color: #000000;">(</span><span
     style="color: #001080;">$venta</span><span
     style="color: #000000;">);</span></div>
  <div><span
     style="color: #000000;">&nbsp;&nbsp;</span><span
     style="color: #001080;">$con</span><span
     style="color: #000000;">-&gt;</span><span
     style="color: #795e26;">commit</span><span
     style="color: #000000;">();</span></div>
  <div><span
     style="color: #000000;">&nbsp;}</span></div>
  <div><span
     style="color: #000000;">}</span></div><br>
 </div>
</muestra-codigo>